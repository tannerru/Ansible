---
- name: Update Windows Machines
  hosts: group_windows
  gather_facts: no
  vars:
    ansible_connection: winrm
    ansible_winrm_server_cert_validation: ignore  # Add this line to set the server cert validation to ignore
    ansible_port: 5985

  tasks:
    - name: Check for available updates
      win_updates:
        state: "search"
      register: updates

    - name: List available updates
      debug:
        var: updates

    - name: Install updates
      win_updates:
        state: "installed"
      when: updates.updates_found > 0
